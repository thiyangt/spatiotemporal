{
  "hash": "07a215ee9db7bdbfac353bf1a85ea616",
  "result": {
    "markdown": "---\ntitle: 'Week 11: Kriging'\nformat:\n  revealjs:\n    slide-number: true\n    show-slide-number: all\n---\n\n\n\n## Random process\n\n- The value of a property at any place $x$, is denoted by $z(x)$. The $z(x)$ is one of an infinity of values of a\nrandom variable $Z(x)$ at that place. We call it a ‘realization’ of the\nprocess.\n\n\n\n- The set of random values at all such places, again infinite in number,\nin a region is a random process, and also denoted $Z(x)$.\n\n\n\n- The random variable is spatially correlated at some scale.\n\n## Stationarity\n\nThe notion of stationarity underpins geostatistics and allows us to\nassume that there is the same degree of variation from place to place.\n\nWe can represent the random process by the model\n\n$$Z(x) = \\mu + \\epsilon(x)$$\n\nwhere $\\mu$ is the mean of the process and $\\epsilon(x)$ is a random quantity with a\nmean of zero and a covariance, $C(\\textbf{h})$, given by\n\n$$C(\\textbf{h}) = E[\\epsilon(x)\\epsilon(x+\\textbf{h})]$$\n\nwhich is equivalent to\n\n$$\n\\begin{aligned}\nC(h) &= E[(Z(x)-\\mu)(Z(x+h)-\\mu)] \\\\\n&= E[Z(x)Z(x+h)-\\mu^2]\n\\end{aligned}\n$$\n\nIn these equations $h$ is the separation between samples in both distance\nand direction; $Z(x)$ and $Z(x + h)$ are the values of $Z$ at places $x$\nand $x + h$.\n\n##\n\nUnder a weaker assumption of intrinsic stationarity in which the\nexpected differences are zero, i.e. $E[Z(x) − Z(x + h)] = 0$.\n\nThen,\n\n$$\n\\begin{aligned}\n\\gamma(\\textbf{h}) &= \\frac{1}{2}var[z(x)-z(x+h)]\\\\ &= \\frac{1}{2}E[\\{Z(x) - Z(x+\\textbf{h})\\}^2]\n\\end{aligned}\n$$\n\n## Covariance function and correlogram\n\n$$\\gamma(\\textbf{h}) = C(0) - C(\\textbf{h})$$\n\nCorrelogram\n\n$$\\rho(\\textbf{h})= \\frac{C(\\textbf{h})}{\\sigma^2}$$\n\n## Computing and modelling variograms\n\n1. Plot the experimental variogram.\n\n2. Choose several models that appear to have the right shape and fit\neach in turn by weighted least squares (Cressie, 1985; McBratney\nandWebster, 1986) in an accredited program.\n\n3. Plot the fitted models on the graph of the experimental variogram\nand assess whether the fit looks reasonable.\n\n4. If all plausible models seem to fit well, choose the one with the\nsmallest residual sum of squares (RSS) or smallest mean square.\n\n\n\n##\n\n5. One might be able to improve a fit in the above sense by elaborating\nthemodel. Any combination of the simple valid models is itself valid. The Akaike information criterion,\nthe AIC (Akaike, 1973), may help to answer. The aim is to minimize it (Webster and McBratney,\n1989; Webster and Oliver, 2007).\n\n## Factors affect the reliability of the experimental variogram\n\n- Size of sample\n\n- Lag interval and bin width\n\n- Marginal distribution of the data\n\n- Anisotropy\n\n- Trend\n\n## cross-validation provides a means of choosing among plausiblemodels for variograms\n\n\n- Each\nand every one of the $N$ data points is omitted in turn fromthe set of data\nand its value there is predicted by ordinary punctual kriging with the\nproposed model. \n\n- Three statistics are then calculated; they are the\nmean error (ME), themean squared error (MSE) and themean squared\ndeviation ratio (MSDR)\n\n\n\n## Example: Data\n\n- `meuse` dataset contains measurements for concentrations of different elements, over an area in the Netherlands.\n\n##\n\n::: {.cell .fig-column-margin execution_count=2}\n``` {.python .cell-code}\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport plotnine\nimport skgstat as skg\nfrom pprint import pprint\nfrom plotnine import ggplot, geom_point, aes, stat_smooth, facet_wrap\nimport warnings\nwarnings.filterwarnings(\"ignore\")\n```\n:::\n\n\n## Load data\n\n::: {.cell .fig-column-margin execution_count=3}\n``` {.python .cell-code}\nsrc = skg.data.meuse()\nprint(src.get('origin'))\n\ncoords, vals = src.get('sample')\n# make a nice table\ndf = pd.DataFrame({'x': coords[:, 0], 'y': coords[:, 1], 'lead': vals.flatten()})\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSample dataset of real measurements of heavy metal pollutions\n    in the topsoil on a 15x15 meter plot along the river Meuse.\n    The data is distributed along with the R-package sp.\n    IMPORTANT: If you use this data, cite Pebesma and Bivand (2005)\n    and Bivand et al (2013):\n\n      Pebesma EJ, Bivand RS (2005). “Classes and methods for spatial\n      data in R.” R News, 5(2), 9–13. https://CRAN.R-project.org/doc/Rnews/.\n\n      Bivand RS, Pebesma E, Gomez-Rubio V (2013). Applied spatial data\n      analysis with R, Second edition. Springer, NY. https://asdar-book.org/.\n\n    \n```\n:::\n:::\n\n\n##\n\n::: {.cell .fig-column-margin execution_count=4}\n``` {.python .cell-code}\ndf.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=40}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>x</th>\n      <th>y</th>\n      <th>lead</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>181072</td>\n      <td>333611</td>\n      <td>299</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>181025</td>\n      <td>333558</td>\n      <td>277</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>181165</td>\n      <td>333537</td>\n      <td>199</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>181298</td>\n      <td>333484</td>\n      <td>116</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>181307</td>\n      <td>333330</td>\n      <td>117</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n##\n\nPlotting the x and y coordinates and visually inspect how the z spread out.\n\n::: {.cell .fig-column-margin execution_count=5}\n``` {.python .cell-code}\nfig, ax = plt.subplots(1, 1, figsize=(9, 9))\nart = ax.scatter(coords[:, 0], coords[:, 1], s=50, c=vals.flatten(), cmap='plasma')\nplt.colorbar(art)\n\n```\n\n::: {.cell-output .cell-output-display execution_count=41}\n```\n<matplotlib.colorbar.Colorbar at 0x107eabb50>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](Week11_files/figure-revealjs/cell-6-output-2.png){width=717 height=707}\n:::\n:::\n\n\n#\n\n::: {.cell .fig-column-margin execution_count=6}\n``` {.python .cell-code}\n(ggplot(df, aes('x', 'y', color='lead'))\n + geom_point())\n```\n\n::: {.cell-output .cell-output-display}\n![](Week11_files/figure-revealjs/cell-7-output-1.png){}\n:::\n\n::: {.cell-output .cell-output-display execution_count=42}\n```\n<ggplot: (288509949)>\n```\n:::\n:::\n\n\n# Variogram modelling\n\n- How to choose an appropriate model function\n\n- How to judge fitting quality\n\n- Sample size influence\n\nSource: https://scikit-gstat.readthedocs.io/en/latest/auto_examples/tutorial_03_variogram_models.html#sphx-glr-auto-examples-tutorial-03-variogram-models-py\n\n\n# Kriging\n\n$$Z(x) = \\mu + \\epsilon(x)$$\n\n**Ordinary kriging:** $\\mu$ is an unkown constant\n\n**Simple kriging:** $\\mu$ is a known constant\n\n**Universal kriging:** $\\mu(s)$ is some deterministic function\n\n\n\n\n# Variogram modelling\n\nKriging\n\n\nhttps://scikit-gstat.readthedocs.io/en/latest/auto_examples/tutorial_01_getting_started.html\n\n",
    "supporting": [
      "Week11_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}